<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Reality of the Virtual</title>
    <script src="js/aframe.js"></script>
    <!-- required for the template component https://mozilla.github.io/nunjucks/ -->
    <script src="js/nunjucks.js"></script>
    <!-- third party components -->
    <script src="js/kframe.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- preload scene assets -->
      <a-assets timeout="6000">
        <a-asset-item id="nyan_model" src="assets/nyancat_simple.dae"></a-asset-item>
        <audio id="zizek_talk" src="assets/zizek.mp3"></video>
        <audio id="shoot" src="assets/Laser_Shoot40.mp3">
        <audio id="dubstep" src="assets/bensound-dubstep-compressed.mp3">
        <audio id="carolina" src="assets/carolina.mp3">
        <img id="cardboardvr_texture" src="assets/vr.jpg">
        <img id="drumpf_texture" src="assets/drumpfdrumpf.png">
        <img id="zizek_texture" src="assets/zizek.png">
        <img id="virilio_texture" src="assets/virilio.jpg">
        <img id="hell_texture" src="assets/hell_square.jpg">
        <script id="drumpf_template" type="text/x-nunjucks-template">
          <a-entity id="drumpfs" layout="type: circle; radius: 10" position="0 1 3.8" visible="false">
            <a-animation attribute="rotation" dur="30000" easing="linear" repeat="indefinite" to="0 360 0"></a-animation>
            {% for x in range(num) %}
                <a-plane class="drumpf" look-at="#player" height="5" width="2.5"
                src="#drumpf_texture" transparent="true">
                </a-plane>
            {% endfor %}
          </a-entity>
        </script>
      </a-assets>

      <!-- replace the standard camera with a new one that supports a fusion cursor -->
      <a-entity id="player" position="0 0 3.8">
        <a-camera>
          <a-entity id="cursor" cursor="maxDistance: 30; fuseTimeout: 1500"
                    raycaster="objects: .clickable"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusOuter: 0.03; radiusInner: 0.02;"
                    material="color: black< shader: flat"
                    event-set__1="_event: mouseenter; material.color: limegreen"
                    event-set__2="_event: mouseleave; material.color: black">
                    <a-animation begin="click" easing="ease-in" attribute="scale" fill="backwards" dur="200" from="0.2 0.2 0.2" to="1 1 1"></a-animation>
                    <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" dur="1500" fill="forwards" from="1 1 1" to="0.2 0.2 0.2"></a-animation>
          </a-entity>
        </a-camera>
      </a-entity>

      <!-- the ground box and plane -->
      <a-box id="stand_on" src="#hell_texture" depth="4" height="100" width="4" position="0 -50 4"></a-box>

      <a-plane id="plane" src="#cardboardvr_texture" rotation="-90 0 0" width="4" height="4" color=""></a-plane>

      <!-- interaction 1 - zizek -->
      <a-sphere id="zizek_sphere" class="clickable" src="#zizek_texture" position="0 1.25 -1" rotation="0 330 0" radius="1.25" color="#FFFFFF"
      event-set__1="_event: mouseenter; scale: 1.1 1.1 1.1"
      event-set__2="_event: mouseleave; scale: 1 1 1"
      sound="src: #zizek_talk; autoplay: false; loop: true"
      animation="property: rotation; dur: 15000; easing: linear; loop: true; to: 0 -30 0">
      </a-sphere>

      <a-sky
        id="zizek_sky"
        src="#zizek_texture">
      </a-sky>

      <!-- interaction 2 - virilio / nyan -->
      <a-box id="virilio_box" class="clickable" src="#virilio_texture" position="-1 0.5 1" rotation="0 45 0" width="1" height="1" depth="1" color="#F16745" roughness="0.8"
	    event-set__1="_event: mouseenter; rotation: 0 90 0" event-set__2="_event: mouseleave; rotation: 0 45 0"></a-box>

      <a-entity id="nyan" class="clickable" position="0 5 -14" rotation="0 180 0"
      animation="property: position; dir: alternate; dur: 7000; loop: true; to: 10 3 3"
      sound="src: #dubstep; autoplay: false; loop: true">
        <a-collada-model src="#nyan_model"></a-collada-model>
      </a-entity>

      <!-- interaction 3 - the drumpfs -->
      <a-cylinder id="drumpf_cylinder" class="clickable" position="1 0.75 1" rotation="0 -30 0" radius="0.5" height="1.5" src="#drumpf_texture"
      animation="property: rotation; dur: 15000; easing:linear; loop: true; to: 0 330 0"
      sound="src: #carolina; autoplay: false; loop: true">
      </a-cylinder>

      <a-entity template="src: #drumpf_template" data-num="12"></a-entity>

    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');

      if (scene.hasLoaded) {
        run();
      } else {
        scene.addEventListener('loaded', run);
      }

      function run() {
        // get the elements of the scene we want to control
        const drumpf_cylinder = document.querySelector('#drumpf_cylinder');
        const drumpfs = document.querySelector('#drumpfs');
        const drumpf_items = document.querySelector('.drumpf');
        const carolina_audio = document.querySelector('#carolina');
        const nyan = document.querySelector('#nyan');
        const nyan_audio = document.querySelector('#dubstep');
        const virilio_box = document.querySelector('#virilio_box');
        const zizek_audio = document.querySelector('#zizek_talk');
        const zizek_sphere = document.querySelector('#zizek_sphere');
        const zizek_sky = document.querySelector('#zizek_sky');

        // elements react to clicks
        drumpf_cylinder.addEventListener('click', () => {
          console.log("clicked drumpf_cylinder");
          let visible = drumpfs.getAttribute("visible");
          visible = !visible;
          drumpfs.setAttribute("visible", visible);
          (!carolina_audio.paused) ? carolina_audio.pause() : carolina_audio.play();
        });
        nyan.addEventListener('click', () => {
          console.log("clicked nyan");
          (!nyan_audio.paused) ? nyan_audio.pause() : nyan_audio.play();
        });
        zizek_sphere.addEventListener('click', () => {
          console.log("clicked zizek_sphere");
          (!zizek_audio.paused) ? zizek_audio.pause() : zizek_audio.play();
        });
      }

    </script>
  </body>
</html>
