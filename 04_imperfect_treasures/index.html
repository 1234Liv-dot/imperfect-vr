<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Imperfect Treasure Hunt</title>
    <script src="js/aframe-v0.5.0.js"></script>
    <script src="js/aframe-animation-component.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- preload scene assets-->
      <a-assets timeout="7000">
        <a-asset-item id="mod_chick" src="assets/chick-lowpoly.dae"></a-asset-item>
        <img id="floor" src="assets/floor.jpg">
        <audio id="cube_sound" src="assets/cube_sound.mp3">
      </a-assets>

      <!-- a plane where you "stand on" -->
      <a-plane width="6" height="6" rotation="-90 0 0" src="#floor"></a-plane>

      <!-- replace the standard <p> camera </p> with a new one that has a fuse cursor -->
      <a-entity position="0 0 0">
        <a-camera id="player">
          <a-entity cursor="fuse: true; fuseTimeout: 500;" geometry="primitive: ring" material="color: white;
            shader: flat" position ="0 0 -1" scale="0.01 0.01 0.01"></a-entity>
        </a-camera>
      </a-entity>

      <!-- a figure that changes location when you look at it -->
      <!-- it has sound attached to it -->
      <a-entity id="chicken" position="0 3 -15">
        <a-entity
          collada-model="#mod_chick" sound="src: #cube_sound; loop: true; autoplay: true; poolSize: 5"
          animation__position="property: position; to: 0 0.7 0; dir: alternate; dur: 1000; loop: true"
          animation__grow="property: scale; startEvents: mouseenter; dur: 100; to: 1.3 1.3 1.3"
          animation__shrink="property: scale; startEvents: mouseleave; dur: 300; to: 1 1 1"
          >
        </a-entity>
      </a-entity>

      <!-- a sky around the scene -->
      <a-sky color="#023283">

    </a-scene>
    <script>
      // compute a random new position around you, with a little bit of maths
      function newPosition() {
        var angle = Math.random() * Math.PI * 2;
        var radius = Math.random() * 3 + 13;
        var height = Math.random() * 3 + 1;
        var result = { x: Math.cos(angle)*radius, y: height, z: -Math.sin(angle)*radius };
        return result;
      }
      // tell the box to change its position when triggered
      document.querySelector('#chicken').addEventListener('click', function () {
        console.log("click")
        var newPos = newPosition(); // compute the new position
        this.setAttribute('color', 'red'); // change color
        setTimeout(function() { // wait a little then change color again and move the box to its new position
          this.setAttribute('color', 'green');
          this.setAttribute('position', "" + newPos.x + " " + newPos.y + " " + newPos.z);
        }.bind(this), 290);
      });
    </script>
  </body>
</html>
